<script>
  const apiKey = "2cec88437101b73b1e0480a4f1144988";
  const apiUrl = "https://api.openweathermap.org/data/2.5/weather?units=metric&q=";

  // ✅ DOM elements
  const searchBox = document.querySelector(".search input");
  const searchBtn = document.querySelector(".search button");

  const weatherEl = document.querySelector(".weather");
  const errorEl = document.querySelector(".error");

  const cityEl = document.querySelector(".city");
  const tempEl = document.querySelector(".temp");
  const humidityEl = document.querySelector(".humidity");
  const windEl = document.querySelector(".wind");
  const weatherIcon = document.querySelector(".weather-icon");

  // ✅ Icon mapping (cleaner than many if-else)
  const iconMap = {
    Clouds: "images/clouds.png",
    Clear: "images/clear.png",
    Rain: "images/rain.png",
    Drizzle: "images/drizzle.png",
    Mist: "images/mist.png",
    Snow: "images/snow.png",
  };

  // ✅ Focus input on load
  window.addEventListener("load", () => searchBox.focus());

  function showError(show = true) {
    errorEl.style.display = show ? "block" : "none";
    weatherEl.style.display = show ? "none" : "block";
  }

  function setLoading(isLoading) {
    searchBtn.disabled = isLoading;
    searchBtn.style.opacity = isLoading ? "0.6" : "1";
  }

  async function checkWeather(city) {
    city = city.trim();

    if (!city) return; // ✅ prevent empty input search

    setLoading(true);

    try {
      const response = await fetch(`${apiUrl}${encodeURIComponent(city)}&appid=${apiKey}`);

      if (!response.ok) {
        showError(true);
        return;
      }

      const data = await response.json();

      // ✅ Update UI
      cityEl.textContent = data.name;
      tempEl.textContent = `${Math.round(data.main.temp)}°C`;
      humidityEl.textContent = `${data.main.humidity}%`;

      // ✅ Wind speed conversion: m/s → km/h
      const windKmH = (data.wind.speed * 3.6).toFixed(1);
      windEl.textContent = `${windKmH} km/h`;

      const condition = data.weather?.[0]?.main;
      weatherIcon.src = iconMap[condition] || "images/clouds.png";

      showError(false);
    } catch (error) {
      console.error("Error fetching weather:", error);
      showError(true);
    } finally {
      setLoading(false);
    }
  }

  // ✅ Button click
  searchBtn.addEventListener("click", () => {
    checkWeather(searchBox.value);
  });

  // ✅ Enter key
  searchBox.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      checkWeather(searchBox.value);
    }
  });
</script>
